<link rel="import" href="/bower_components/polymer-redux/polymer-redux.html">
<script src="/node_modules/redux/dist/redux.js"></script>

<script>
const initialState = {
  party: [],
  screen: 'openingMenu'
};

const sampleParty = () => {
  return [{
    charClass: 'WM',
    name: 'AAAA',
    weapons: [], armor: [], spells: []
  }, {
    charClass: 'Th',
    name: 'BBBB',
    weapons: [], armor: [], spells: []
  }, {
    charClass: 'BB',
    name: 'CCCC',
    weapons: [], armor: [], spells: []
  }, {
    charClass: 'RM',
    name: 'DDDD',
    weapons: [], armor: [], spells: []
  }];
}

const updateArray = (array, index, update) => {
  return array.map((item, i) => {
    if (i !== index) {
      return item;
    }
    return Object.assign({}, item, update);
  });
}

const reducer = (state, action) => {
  if (!state) return initialState;

  switch (action.type) {
    case 'CHAR_CLASS_SET':
      const party = state.party.slice();
      party.push({ charClass: action.charClass });
      return Object.assign({}, state, { party: party });
    case 'CHAR_NAME_SET':
      return Object.assign({}, state, {
        party: updateArray(state.party, state.party.length - 1, { name: action.name })
      })
    case 'LOAD_GAME':
      console.log('TODO: load from actual saved game');
      return Object.assign({}, state, { party: sampleParty() });
    case 'SCREEN_CHANGED':
      return Object.assign({}, state, { screen: action.payload });

    default:
      return state;
  }
};

const store = Redux.createStore(reducer, initialState);
ReduxMixin = PolymerRedux(store);
</script>