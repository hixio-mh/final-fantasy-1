<script>
(function(scope) {
  scope.FF = scope.FF || {};

  scope.FF.VehicleBehavior = {
    properties: {
      Vehicles: {
        readonly: true,
        type: Object,
        value: function() {
          return {
            Airship: 'airship',
            Canoe: 'canoe',
            Foot: 'foot',
            Ship: 'ship'
          }
        }
      }
    },

    isPassable: function(options) {
      var passable;
      // If currently in airship can go anywhere
      if (options.vehicle === this.Vehicles.Airship) {
        return true;
      }

      // If the tile we are going to is not passable, nothing more to check
      if (!options.goingToTile.passableBy) {
        return false;
      }

      // If going to a river, party must own canoe
      if (options.goingToTile.passableBy === this.Vehicles.Canoe) {
        passable = this._hasVehicle(options.partyVehicles, this.Vehicles.Canoe);
        if (passable) {
          this._enteringVehicle(this.Vehicles.Canoe);
        }
        return passable;
      }

      // If going to ocean, party must own ship and ship must be on tile we are going to
      if (options.goingToTile.passableBy === this.Vehicles.Ship) {
        var hasVehicle = this._hasVehicle(options.partyVehicles, this.Vehicles.Ship);
        var isShipThere = options.goingToPosition.y === options.shipPosition.y
          && options.goingToPosition.x === options.shipPosition.x;
        passable = hasVehicle && isShipThere;
        if (passable) {
          this._enteringVehicle(this.Vehicles.Ship);
        }
        return passable;
      }

      if (options.goingToTile.passableBy === this.Vehicles.Foot) {
        if (this.vehicle === this.Vehicles.Ship) {
        // going from ship -> foot, make sure going to dock
          passable = !!this.goingToTile.dockable;
        } else {
        // going from canoe->foot or foot->foot is always good
          passable = true;
        }
        this._enteringVehicle(this.Vehicles.Foot);
        return passable;
      }
    },

    _enteringVehicle: function(newVehicle) {
      console.log('dock ship if leaving it, save its coords');
      this.fire('ff-vehicle-change', {
        vehicle: newVehicle
      });
    },

    _hasVehicle: function(partyVehicles, vehicle) {
      return partyVehicles.indexOf(vehicle) > -1;
    }

  };

}(window));
</script>