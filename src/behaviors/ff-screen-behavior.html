<script>
(function(scope) {
  scope.FF = scope.FF || {};

  scope.FF.ScreenBehavior = {
    properties: {
      currentScreen: {
        observer: 'onScreenChange',
        reflectToAttribute: true,
        type: Boolean,
        value: false
      }
    },

    onScreenChange: function(value) {
      if (value === false) {
        this._onScreenClosed();
      } else {
        this._onScreenOpened();
      }
      this.hidden = !this.currentScreen;
    },

    onScreenClosed: function() {},
    onScreenOpened: function() {},

    // Override if a screen contains multiple key handlers
    primaryKeyHandler: function() {},

    _activateKeyHandler: function() {
      this._findKeyHandler().activate();
    },

    _deactivateKeyHandler: function() {
      Polymer.dom(this.root).querySelectorAll('ff-keyhandler').forEach(function(keyHandler) {
        keyHandler.deactivate();
      });
    },

    _findKeyHandler: function() {
      return this.primaryKeyHandler()
        || this._keyHandler()
        || this._keyHandlerInSelector()
        || this._noopKeyHandler();
    },

    _keyHandler: function() {
      return Polymer.dom(this.root).querySelector('ff-keyhandler');
    },

    _keyHandlerInSelector() {
      var selector = Polymer.dom(this.root).querySelector('ff-selector');
      if (selector) {
        return selector.$.keyHandler;
      }
    },

    _noopKeyHandler: function() {
      return {
        activate: function() {},
        deactivate: function() {}
      };
    },

    _onScreenClosed: function() {
      this._deactivateKeyHandler();
      this.onScreenClosed.call(this);
    },

    _onScreenOpened: function() {
      this._activateKeyHandler();
      this.onScreenOpened.call(this);
    }

  };
}(window));
</script>